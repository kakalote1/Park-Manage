{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./src/views/login/loginFace.vue?a755","webpack:///src/views/login/loginFace.vue","webpack:///./src/views/login/loginFace.vue?09ea","webpack:///./src/views/login/loginFace.vue","webpack:///./src/views/login/loginFace.vue?26d4"],"names":["DESCRIPTORS","defineProperty","f","FunctionPrototype","Function","prototype","FunctionPrototypeToString","toString","nameRE","NAME","configurable","get","call","this","match","error","render","_vm","_h","$createElement","_c","_self","_v","attrs","staticStyle","on","takePicture","toLogin","toHome","staticRenderFns","components","data","computed","watch","created","mounted","openCamera","beforeCreate","beforeMount","beforeUpdate","updated","beforeDestroy","destroyed","activated","methods","$store","commit","$router","replace","$dialog","confirm","message","localStorage","removeItem","GroupIds","Image","imagebase64","console","log","response","score","uid","localUid","position","err","navigator","mediaDevices","getUserMedia","constraints","getBase64","canvas","width","video","videoWidth","height","videoHeight","getContext","drawImage","component"],"mappings":"0HAAA,IAAIA,EAAc,EAAQ,QACtBC,EAAiB,EAAQ,QAAuCC,EAEhEC,EAAoBC,SAASC,UAC7BC,EAA4BH,EAAkBI,SAC9CC,EAAS,wBACTC,EAAO,OAIPT,KAAiBS,KAAQN,IAC3BF,EAAeE,EAAmBM,EAAM,CACtCC,cAAc,EACdC,IAAK,WACH,IACE,OAAOL,EAA0BM,KAAKC,MAAMC,MAAMN,GAAQ,GAC1D,MAAOO,GACP,MAAO,Q,yCCjBf,IC2BA,ED3BIC,EAAS,WAAa,IAAIC,EAAIJ,KAASK,EAAGD,EAAIE,eAAmBC,EAAGH,EAAII,MAAMD,IAAIF,EAAG,OAAOE,EAAG,UAAU,CAACH,EAAIK,GAAG,UAAUF,EAAG,QAAQ,CAACG,MAAM,CAAC,IAAM,MAAMH,EAAG,MAAM,CAACI,YAAY,CAAC,aAAa,SAAS,CAACJ,EAAG,SAAS,CAACK,GAAG,CAAC,MAAQR,EAAIS,cAAc,CAACT,EAAIK,GAAG,YAAYF,EAAG,MAAM,CAACI,YAAY,CAAC,aAAa,SAAS,CAACJ,EAAG,SAAS,CAACK,GAAG,CAAC,MAAQR,EAAIU,UAAU,CAACV,EAAIK,GAAG,gBAAgBF,EAAG,MAAM,CAACI,YAAY,CAAC,aAAa,UAAU,CAACJ,EAAG,SAAS,CAACK,GAAG,CAAC,MAAQR,EAAIW,SAAS,CAACX,EAAIK,GAAG,eACjdO,EAAkB,G,wDC+BtB,GAEEC,WAAY,GACZC,KAHF,WAKI,MAAO,IAKTC,SAAU,GAEVC,MAAO,GAEPC,QAdF,aAkBEC,QAlBF,WAmBItB,KAAKuB,cAEPC,aArBF,aAsBEC,YAtBF,aAuBEC,aAvBF,aAwBEC,QAxBF,aAyBEC,cAzBF,aA0BEC,UA1BF,aA2BEC,UA3BF,aA6BEC,QAAS,CACPhB,OADJ,WAGM,OAAN,OAAM,GACAf,KAAKgC,OAAOC,OAAO,YAAa,GAChCjC,KAAKkC,QAAQC,QAAQ,CAA3B,eAEIrB,QAPJ,WAOA,WAEMd,KAAKoC,QAAQC,QAAQ,CACnBC,QAAS,aACjB,iBAEQC,aAAaC,WAAW,YACxB,EAAR,mCACA,uBAKI3B,YApBJ,WAoBA,WACA,mBACA,GACQ4B,SAAU,CAAC,cACXC,MAAOC,GAET,OAAN,OAAM,CAAN,qBACQC,QAAQC,IAAI,2BAA4BC,GACxC,IAAR,eACA,aACA,mDACQF,QAAQC,IAAI,QAASE,EAAO,MAAOC,EAAK,WAAYC,GAEhDF,EAAQ,IACVH,QAAQC,IAAI,WACRG,IAAQC,GACVL,QAAQC,IAAI,SAEZ,OAAZ,OAAY,GACA,EAAZ,6BACY,EAAZ,iCAEYD,QAAQC,IAAI,UACZ,EAAZ,QACcP,QAAS,aACTY,SAAU,WAIdN,QAAQC,IAAI,SACZ,EAAV,QACYP,QAAS,aACTY,SAAU,YAGtB,mBACQN,QAAQC,IAAI,YAAaM,GACzB,EAAR,QACUb,QAAS,aACTY,SAAU,YAMhB3B,WAjEJ,WAmEM,IAAN,mDACM6B,UAAUC,aAAaC,aAAaC,GAC1C,kBACQ,EAAR,gCACQ,EAAR,YACQ,EAAR,6BACU,EAAV,WAGA,mBAEQ,QAAR,+BAIIC,UAlFJ,WAoFM,IAAN,mCACMC,EAAOC,MAAQC,EAAMC,WACrBH,EAAOI,OAASF,EAAMG,YAEtBL,EAAOM,WAAW,MAAMC,UAAUL,EAAO,EAAG,EAAGF,EAAOC,MAAOD,EAAOI,QAEpE,IAAN,qEACM,OAAOlB,KCxJqV,I,wBCQ9VsB,EAAY,eACd,EACA9D,EACAa,GACA,EACA,KACA,WACA,MAIa,aAAAiD,E,2CCnBf","file":"static/js/chunk-54f1d50a.717475af.js","sourcesContent":["var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.github.io/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('van-row',[_vm._v(\" 人脸识别 \"),_c('video',{attrs:{\"src\":\"\"}}),_c('div',{staticStyle:{\"margin-top\":\"50px\"}},[_c('button',{on:{\"click\":_vm.takePicture}},[_vm._v(\"开始识别\")])]),_c('div',{staticStyle:{\"margin-top\":\"50px\"}},[_c('button',{on:{\"click\":_vm.toLogin}},[_vm._v(\"使用账号密码登录\")])]),_c('div',{staticStyle:{\"margin-top\":\"100px\"}},[_c('button',{on:{\"click\":_vm.toHome}},[_vm._v(\"进入首页\")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!--\r\n * @Description: \r\n * @Author: Li bin\r\n * @Github: https://github.com/hzylyh\r\n * @Date: 2020-12-10 14:22:50\r\n * @LastEditors: yanxiao\r\n-->\r\n<!-- 登录-人脸识别 -->\r\n<template>\r\n  <van-row>\r\n    人脸识别\r\n    <video src=\"\"></video>\r\n    <div style=\"margin-top: 50px\">\r\n      <button @click=\"takePicture\">开始识别</button>\r\n    </div>\r\n    <div style=\"margin-top: 50px\">\r\n      <button @click=\"toLogin\">使用账号密码登录</button>\r\n    </div>\r\n    <div style=\"margin-top: 100px\">\r\n      <button @click=\"toHome\">进入首页</button>\r\n    </div>\r\n  </van-row>\r\n</template>\r\n\r\n<script>\r\n//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）\r\n//例如：import 《组件名称》 from '《组件路径》';\r\nlet video;\r\nimport { faceLogin } from \"@/api/userApi\";\r\nimport {\r\n  uidLogin,  // 登录语音\r\n} from \"@/utils/user\";\r\nexport default {\r\n  //import引入的组件需要注入到对象中才能使用\r\n  components: {},\r\n  data () {\r\n    //这里存放数据\r\n    return {\r\n\r\n    };\r\n  },\r\n  //监听属性 类似于data概念\r\n  computed: {},\r\n  //监控data中的数据变化\r\n  watch: {},\r\n  //生命周期 - 创建完成（可以访问当前this实例）\r\n  created () {\r\n\r\n  },\r\n  //生命周期 - 挂载完成（可以访问DOM元素）\r\n  mounted () {\r\n    this.openCamera()\r\n  },\r\n  beforeCreate () { }, //生命周期 - 创建之前\r\n  beforeMount () { }, //生命周期 - 挂载之前\r\n  beforeUpdate () { }, //生命周期 - 更新之前\r\n  updated () { }, //生命周期 - 更新之后\r\n  beforeDestroy () { }, //生命周期 - 销毁之前\r\n  destroyed () { }, //生命周期 - 销毁完成\r\n  activated () { }, //如果页面有keep-alive缓存功能，这个函数会触发\r\n  //方法集合\r\n  methods: {\r\n    toHome () {\r\n      // 用户登录后使用uid登录语音\r\n      uidLogin();\r\n      this.$store.commit(\"bottomNav\", 0)\r\n      this.$router.replace({ name: 'Home' })\r\n    },\r\n    toLogin () {\r\n      //注销登录页面\r\n      this.$dialog.confirm({\r\n        message: '是否放弃人脸识别',\r\n      }).then(() => {\r\n        // window.android.logout()\r\n        localStorage.removeItem('userInfo')\r\n        this.$router.replace({ name: 'Login' })\r\n      }).catch(() => {\r\n        // on cancel\r\n      });\r\n    },\r\n    // 点击拍照\r\n    takePicture () {\r\n      let imagebase64 = this.getBase64()\r\n      let info = {\r\n        GroupIds: [\"yzExpo-App\"],\r\n        Image: imagebase64\r\n      }\r\n      faceLogin(info).then(response => {\r\n        console.log(\"responseresponseresponse\", response);\r\n        let score = response.data.score\r\n        let uid = response.data.uid\r\n        let localUid = JSON.parse(localStorage.getItem(\"userInfo\")).uid\r\n        console.log(\"score\", score, \"uid\", uid, 'localUid', localUid);\r\n\r\n        if (score > 60) {\r\n          console.log(\"相似度匹配成功\");\r\n          if (uid === localUid) {\r\n            console.log(\"uid一样\");\r\n            // 用户登录后使用uid登录语音\r\n            uidLogin();\r\n            this.$store.commit(\"bottomNav\", 0)\r\n            this.$router.replace({ name: 'Home' })\r\n          } else {\r\n            console.log(\"uid不一样\");\r\n            this.$toast({\r\n              message: '人脸检测失败，请重试',\r\n              position: 'top',\r\n            });\r\n          }\r\n        } else {\r\n          console.log(\"不在人脸库\");\r\n          this.$toast({\r\n            message: '人脸检测失败，请重试',\r\n            position: 'top',\r\n          });\r\n        }\r\n      }).catch(err => {\r\n        console.log(\"错误没有检测到人脸\", err);\r\n        this.$toast({\r\n          message: '人脸检测失败，请重试',\r\n          position: 'top',\r\n        });\r\n      })\r\n    },\r\n\r\n    // 打开摄像头(初始化调用)\r\n    openCamera () {\r\n      // 定义使用视频video 或/和 audio\r\n      let constraints = { video: { width: 320, height: 320, facingMode: \"user\" } };\r\n      navigator.mediaDevices.getUserMedia(constraints)\r\n        .then(function (mediaStream) {\r\n          video = document.querySelector('video');\r\n          video.srcObject = mediaStream;\r\n          video.onloadedmetadata = function (e) {\r\n            video.play();\r\n          };\r\n        })\r\n        .catch(function (err) {\r\n          // 摄像头调用失败\r\n          console.log(err.name + \": \" + err.message);\r\n        });\r\n    },\r\n\r\n    getBase64 () {\r\n      // 创建canvas DOM\r\n      let canvas = document.createElement(\"canvas\");\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      // 使用canvas获取video上的当前一帧\r\n      canvas.getContext(\"2d\").drawImage(video, 0, 0, canvas.width, canvas.height);\r\n      // 将canvas绘制的图片转换成base64\r\n      let imagebase64 = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream');\r\n      return imagebase64\r\n    },\r\n\r\n  },\r\n}\r\n</script>\r\n<style lang='scss' scoped>\r\n//@import url(); 引入公共css类\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./loginFace.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./loginFace.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./loginFace.vue?vue&type=template&id=11d8ad72&scoped=true&\"\nimport script from \"./loginFace.vue?vue&type=script&lang=js&\"\nexport * from \"./loginFace.vue?vue&type=script&lang=js&\"\nimport style0 from \"./loginFace.vue?vue&type=style&index=0&id=11d8ad72&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"11d8ad72\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./loginFace.vue?vue&type=style&index=0&id=11d8ad72&lang=scss&scoped=true&\""],"sourceRoot":""}